<template>
  <DataTable
      ref="tableRef"
      class="p-datatable-sm"
      responsiveLayout="scroll"
      :scrollable="true"
      scrollHeight="flex"
      scrollDirection="both"
      :resizableColumns="true"
      columnResizeMode="expand"
      :paginator="true"
      paginatorTemplate="CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown"
      currentPageReportTemplate="{first} - {last} / {totalRecords}"
      :lazy="true"
      v-model:first="tableContext.pageable.offset"
      :rows="tableContext.pageable.limit"
      @page="onDataTableEvent"
      @sort="onDataTableEvent"
      :value="tableContext.data.content"
      :totalRecords="tableContext.data.totalElements"
      v-model:filters="tableContext.filters"
      filterDisplay="row"
      stripedRows
      showGridlines
  >
    <template #empty>
      没有数据.
    </template>
    <template #paginatorstart>
      <Dropdown
          v-model="tableContext.pageable.limit"
          :options="tableContext.limitSelectOptions"
          optionLabel="limit"
          optionValue="limit"
          placeholder="Select a City"
      />
    </template>
    <template #paginatorend>
      <slot name="paginatorend"/>
    </template>
    <slot/>
  </DataTable>
</template>

<script setup lang="ts">
import {ref} from "vue";
import DataTable from "primevue/datatable";
import Dropdown from "primevue/dropdown";
import {PsrPrmFilterPagingDataTableContext} from "./PsrPrmFilterPagingDataTableContext";

const props = defineProps<{
  tableContext: PsrPrmFilterPagingDataTableContext<any>
}>()
const tableRef = ref<DataTable>()

function handleExport() {
  tableRef.value?.exportCSV();
}

function onDataTableEvent(event: any) {
  props.tableContext.pageable.offset = event.first
  props.tableContext.pageable.limit = event.rows
  if (event.sortField) {
    props.tableContext.pageable.sort = event.sortField
    props.tableContext.pageable.dir = event.sortOrder > 0 ? 'ASC' : 'DESC'
  } else {
    delete props.tableContext.pageable.sort
    delete props.tableContext.pageable.dir
  }
  props.tableContext.load()
}

</script>

<style>
.p-datatable-scrollable .p-datatable-thead {
  z-index: 2 !important;
}
</style>